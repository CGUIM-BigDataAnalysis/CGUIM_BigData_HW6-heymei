ggplot()+geom_point(data = merge9 ,aes(x=as.numeric(camera_new_number),y=as.numeric(people_total)),stat="identity")+geom_smooth(data = merge9 , aes(x=as.numeric(camera_new_number),y=as.numeric(people_total)),method = "lm") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "CCTV數量" , y = "學校數量" )
##bar圖
##地區與人口密度
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(人口密度)),y=as.numeric(人口密度)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口密度" )
##地區與人口數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(people_total)),y=as.numeric(people_total)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口數" )
##地區與平均收入
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(所得)),y=as.numeric(所得)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "平均收入" )
##地區與破案率
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(破案率)),y=as.numeric(破案率)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "破案率" )
##地區與CCTV數量
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_new_number)),y=as.numeric(camera_new_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
##地區與學校數目
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(school_number)),y=as.numeric(school_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "學校數目" )
##地區與警察局
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(policenumber)),y=as.numeric(policenumber)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "警察局" )
##地區與犯罪次數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(發生數)),y=as.numeric(發生數)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "犯罪次數" )
abc1 <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/ss10101ya201761650129.txt")
abc2 <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/ss10101ya2017616502951.txt")
View(abc1)
abc1 <- abc1[c(1),]
abc2 <- abc2[c(1),]
View(abc1)
abc3 <- full_join(abc1,abc2)
abc3 <- rbind(abc1,abc2)
View(abc3)
install.packages("treemap")
install.packages("reshape2")
library(reshape2)
abc11<-abc1(airquality,id.vars = )
library(reshape2)
abc11<-abc1(airquality,id.vars = )
abc11<-melt(abc1,id.vars = )
View(abc11)
treemap(abc11,
index=c("variable","value"), #分組依據
vSize="population", #區塊大小
vColor="GNI", #顏色深淺
type="value")
library(treemap)
treemap(abc11,
index=c("variable","value"), #分組依據
vSize="population", #區塊大小
vColor="GNI", #顏色深淺
type="value")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="GNI", #顏色深淺
type="value")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value" , family = "HanziPen TC Regular")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value" )
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" )
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="大安區刑事案件分類",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="大安區",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular")
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'number',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
View(merge9_correlation_need)
library(dplyr)
library(ggplot2)
library(corrplot)
merge9$steal_total <- merge9$carnumber+merge9$bikenumber
merge9_correlation <- merge9[,c(3:17)]
merge9_correlation$carnumber <- as.numeric(merge9_correlation$carnumber)
merge9_correlation$bikenumber <- as.numeric(merge9_correlation$bikenumber)
merge9_correlation$policenumber <- as.numeric(merge9_correlation$policenumber)
merge9_correlation$density <- as.numeric(merge9_correlation$人口密度)
merge9_correlation$camera_number <- as.numeric(merge9_correlation$camera_number)
merge9_correlation$school_number <- as.numeric(merge9_correlation$school_number)
merge9_correlation$camera_new_number <- as.numeric(merge9_correlation$camera_new_number)
merge9_correlation$steal_total <- as.numeric(merge9_correlation$steal_total)
merge9_correlation$number_of_occurrences <- as.numeric(merge9_correlation$發生數)
merge9_correlation$Cracked_number <- as.numeric(merge9_correlation$破獲數)
merge9_correlation$Detection_rate <- as.numeric(merge9_correlation$破案率)
merge9_correlation$income <- as.numeric(merge9_correlation$所得)
merge9_correlation_need <- merge9_correlation[c(1,2,3,4,5,6,8,9,14,15,16,17,18,19,20)]
View(merge9_correlation_need)
merge9_correlation_need <- merge9_correlation_need[c(1,6,8,9,10,11,12,13,14,15)]
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'number',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular")
treemap(abc11,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular" , title = "大安區刑事案件分類")
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'number',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'circle',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
#bar圖
##地區與人口密度
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(人口密度)),y=as.numeric(人口密度)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口密度" )
##地區與人口數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(people_total)),y=as.numeric(people_total)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口數" )
##地區與平均收入
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(所得)),y=as.numeric(所得)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "平均收入" )
##地區與破案率
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(破案率)),y=as.numeric(破案率)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "破案率" )
##地區與CCTV數量
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_new_number)),y=as.numeric(camera_new_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
##地區與學校數目
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(school_number)),y=as.numeric(school_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "學校數目" )
##地區與警察局
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(policenumber)),y=as.numeric(policenumber)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "警察局" )
##地區與犯罪次數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(發生數)),y=as.numeric(發生數)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "犯罪次數" )
View(abc3)
View(abc3)
View(abc11)
View(abc3)
View(abc1)
View(abc11)
View(abc2)
abc11<-melt(abc1)
library(reshape2)
abc11<-melt(abc1)
abc11<-melt(abc1,id.vars = c(1,2))
abc12<-melt(abc1,id.vars = c(variable,value))
View(abc1)
abc12<-melt(abc1,id.vars = c(1:68))
View(abc12)
abc12<-melt(abc1,id.vars = c())
View(abc12)
treemap(abc12,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular" , title = "大安區刑事案件分類")
library(treemap)
treemap(abc12,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular" , title = "大安區刑事案件分類")
View(abc12)
abc12[c(-2:-5),]
abc12[c(-2,-3,-4,-5),]
abc12 <- abc12[c(-2,-3,-4,-5),]
abc12 <- abc12[c(-2,-3,-4,-5,-14,-15),]
abc12<-melt(abc1,id.vars = c())
abc12 <- abc12[c(-2,-3,-4,-5,-14,-15,-30,-31,-32,-33,-34,-42,-43),]
treemap(abc12,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular" , title = "大安區刑事案件分類")
#install.packages("data.table")
library(data.table)
car <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
library(dplyr)
##人口表
##people_taipei 只有台北市的人口資料
##people_taipei_area 台北市各區域的總人口，男生人口，女生人口
people_taipei <- people[grepl("臺北市",people$區域別),]
#install.packages("data.table")
library(data.table)
car <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
#install.packages("data.table")
library(data.table)
car <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
bike <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/bike.txt" ,colClasses = "character")
police <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/police.txt" ,colClasses = "character")
people <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/opendata10512M030.csv",colClasses = "character" , skip = 1)
land <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/opendata105N010.csv",colClasses = "character" , skip = 1)
camera <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/1041008.csv",colClasses = "character")
school <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/1050113臺北市各級學校分布圖%2528含國小_國中_高中職_特教學校_市立大學%25291030730+%281%29.txt",colClasses = "character")
detection_rate <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/ss10101cm2017614235576.txt",colClasses = "character")
average_income <- fread("~/R/CGUIM_BigData_HW6-heymei/R FInal/txt/台北各區家戶平均所得.txt",colClasses = "character")
camera_new <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/台北各分局的管核的監視器.txt",colClasses = "character" , skip = 1)
library(dplyr)
##人口表
##people_taipei 只有台北市的人口資料
##people_taipei_area 台北市各區域的總人口，男生人口，女生人口
people_taipei <- people[grepl("臺北市",people$區域別),]
people_taipei_area <- group_by(people_taipei,區域別) %>% summarise(people_total = sum(as.numeric(人口數)) , people_man = sum(as.numeric(`人口數-男`)) , people_woman = sum(as.numeric(`人口數-女`)))
people_taipei_area$地區 <- substr(people_taipei_area$區域別 , start = 4 , stop = 6)
##汽車偷竊
##cartotal 台北市各區域汽車偷竊次數
car$地區 <- substr(car$`發生(現)地點`,start = 4,stop = 6)
car_total <- group_by(car,地區) %>% summarise(carnumber = n()) #地區&時段
##自行車偷竊
##biketotal 台北市各區域自行車偷竊次數
bike$地區 <- substr(bike$`發生(現)地點` , start = 4 , stop = 6)
bike_total <- group_by(bike,地區) %>% summarise(bikenumber = n())
##警察局
##台北市各區域警察局總數
police$地區 <- substr(police$poi_addr , start = 4 , stop = 6)
police_station_total <-  group_by(police,地區) %>% summarise(policenumber = n())
##人口密度
##land_taipei 臺北市資料
land_taipei <- land[grepl("臺北市",land$區域別),]
land_taipei$地區 <- substr(land_taipei$區域別 , start = 4 , stop = 6)
land_taipei_need <-land_taipei[,c(5,6)]
##監視器
##
camera_need <- camera[,c(3,5)]
camera_need$precinct <- substr(camera_need$precinct , start = 1 , stop = 2)
camera_need$地區 <- ifelse(camera_need$precinct=="",yes="",no = paste0(camera_need$precinct,"區"))
camera_need <- camera_need[!precinct==""]
freq_location_taipei<-camera_need[,.N,by = 地區]
colnames(freq_location_taipei) <- c("地區","camera_number")
##學校
school[grepl('中崙高中',school_name)]$address <- "臺北市松山區八德路四段101號"
school[grepl('中崙高中',school_name)]$address <- iconv(school[grepl('中崙高中',school_name)]$address,"utf-8","utf-8")
school$地區 <- substr(school$address , start = 4 , stop = 6)
school_total <- school[,.N,by = "地區"]
colnames(school_total) <- c("地區","school_number")
#以學校層級分
school_byschool <- school[,.N,by = school]
colnames(school_byschool) <- c("school","school_number")
##破案率
detection_rate <- detection_rate[c(1:180),]
detection_rate$分區 <- substr(detection_rate$分局 , start = 1 , stop = 2)
detection_rate_need <- group_by(detection_rate,分區) %>% summarise(區域 = n() , 發生數 = sum(as.numeric(`發生數(件)`)) , 破獲數 = sum(as.numeric(`破獲數(件)`)))
detection_rate_need$破案率 <- round(detection_rate_need$破獲數/detection_rate_need$發生數,digits = 2)
detection_rate_need <- detection_rate_need[c(1:12),]
detection_rate_need$地區 <- paste0(detection_rate_need$分區,"區")
detection_rate_need <- detection_rate_need[,c(3:6)]
##平均所得
average_income$所得 <- as.numeric(average_income$所得)*1000
##完整camera資料
camera_new$地區 <- paste0(substr(camera_new$所屬單位 , start = 1 , stop = 2),"區")
camera_new_need <- camera_new[,c(1,3,5)]
camera_new_need_statistics <- group_by(camera_new_need,地區) %>% summarise(camera_new_number = n())
##資料結合
##merge3 有台北市各區域總人口、男生人口數、女生人口數、汽車發生偷竊次數、自行車發生偷竊次數、警察局總數
merge1 <- full_join(people_taipei_area,car_total,by="地區")
merge2 <- full_join(merge1,bike_total,by="地區")
merge3 <- full_join(merge2,police_station_total,by="地區")
merge4 <- full_join(merge3,land_taipei_need,by="地區")
merge5 <- merge(merge4,freq_location_taipei,by="地區")
merge6 <- full_join(merge5,school_total,by="地區")
merge7 <- merge(merge6,detection_rate_need,by="地區")
merge8 <- merge(merge7,average_income,by="地區")
merge9 <- merge(merge8,camera_new_need_statistics,by="地區")
library(dplyr)
library(ggplot2)
library(corrplot)
merge9$steal_total <- merge9$carnumber+merge9$bikenumber
merge9_correlation <- merge9[,c(3:17)]
View(merge9_correlation)
merge9_correlation <- merge9[,c(3:17)]
merge9_correlation$carnumber <- as.numeric(merge9_correlation$carnumber)
merge9_correlation$bikenumber <- as.numeric(merge9_correlation$bikenumber)
merge9_correlation$policenumber <- as.numeric(merge9_correlation$policenumber)
merge9_correlation$density <- as.numeric(merge9_correlation$人口密度)
merge9_correlation$camera_number <- as.numeric(merge9_correlation$camera_number)
merge9_correlation$school_number <- as.numeric(merge9_correlation$school_number)
merge9_correlation$camera_new_number <- as.numeric(merge9_correlation$camera_new_number)
merge9_correlation$steal_total <- as.numeric(merge9_correlation$steal_total)
merge9_correlation$number_of_occurrences <- as.numeric(merge9_correlation$發生數)
merge9_correlation$Cracked_number <- as.numeric(merge9_correlation$破獲數)
merge9_correlation$Detection_rate <- as.numeric(merge9_correlation$破案率)
merge9_correlation$income <- as.numeric(merge9_correlation$所得)
merge9_correlation$camera_number <- as.numeric(merge9_correlation$camera_new_number)
merge9_correlation_need <- merge9_correlation[c(6,8,9,16,17,19,20)]
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'circle',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
install.packages("readODS")
land <- read.ods("~/R/CGUIM_BigData_HW6-heymei/R Final/63914313865.ods")
library(readODS)
land <- read.ods("~/R/CGUIM_BigData_HW6-heymei/R Final/63914313865.ods")
land <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/opendata105N010.csv",colClasses = "character" , skip = 1)
#install.packages("data.table")
library(data.table)
library(readODS)
car <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
bike <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/bike.txt" ,colClasses = "character")
police <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/police.txt" ,colClasses = "character")
people <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/opendata10512M030.csv",colClasses = "character" , skip = 1)
land <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/opendata105N010.csv",colClasses = "character" , skip = 1)
camera <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/1041008.csv",colClasses = "character")
school <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/1050113臺北市各級學校分布圖%2528含國小_國中_高中職_特教學校_市立大學%25291030730+%281%29.txt",colClasses = "character")
detection_rate <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/ss10101cm2017614235576.txt",colClasses = "character")
average_income <- fread("~/R/CGUIM_BigData_HW6-heymei/R FInal/txt/台北各區家戶平均所得.txt",colClasses = "character")
camera_new <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/台北各分局的管核的監視器.txt",colClasses = "character" , skip = 1)
View(land_taipei)
library(dplyr)
##人口表
##people_taipei 只有台北市的人口資料
##people_taipei_area 台北市各區域的總人口，男生人口，女生人口
people_taipei <- people[grepl("臺北市",people$區域別),]
people_taipei_area <- group_by(people_taipei,區域別) %>% summarise(people_total = sum(as.numeric(人口數)) , people_man = sum(as.numeric(`人口數-男`)) , people_woman = sum(as.numeric(`人口數-女`)))
people_taipei_area$地區 <- substr(people_taipei_area$區域別 , start = 4 , stop = 6)
##汽車偷竊
##cartotal 台北市各區域汽車偷竊次數
car$地區 <- substr(car$`發生(現)地點`,start = 4,stop = 6)
car_total <- group_by(car,地區) %>% summarise(carnumber = n()) #地區&時段
##自行車偷竊
##biketotal 台北市各區域自行車偷竊次數
bike$地區 <- substr(bike$`發生(現)地點` , start = 4 , stop = 6)
bike_total <- group_by(bike,地區) %>% summarise(bikenumber = n())
##警察局
##台北市各區域警察局總數
police$地區 <- substr(police$poi_addr , start = 4 , stop = 6)
police_station_total <-  group_by(police,地區) %>% summarise(policenumber = n())
##人口密度
##land_taipei 臺北市資料
land_taipei <- land[grepl("臺北市",land$區域別),]
land_taipei$地區 <- substr(land_taipei$區域別 , start = 4 , stop = 6)
land_taipei_need <-land_taipei[,c(4,5,6)]
##監視器
##
camera_need <- camera[,c(3,5)]
camera_need$precinct <- substr(camera_need$precinct , start = 1 , stop = 2)
camera_need$地區 <- ifelse(camera_need$precinct=="",yes="",no = paste0(camera_need$precinct,"區"))
camera_need <- camera_need[!precinct==""]
freq_location_taipei<-camera_need[,.N,by = 地區]
colnames(freq_location_taipei) <- c("地區","camera_number")
##學校
school[grepl('中崙高中',school_name)]$address <- "臺北市松山區八德路四段101號"
school[grepl('中崙高中',school_name)]$address <- iconv(school[grepl('中崙高中',school_name)]$address,"utf-8","utf-8")
school$地區 <- substr(school$address , start = 4 , stop = 6)
school_total <- school[,.N,by = "地區"]
colnames(school_total) <- c("地區","school_number")
#以學校層級分
school_byschool <- school[,.N,by = school]
colnames(school_byschool) <- c("school","school_number")
##破案率
detection_rate <- detection_rate[c(1:180),]
detection_rate$分區 <- substr(detection_rate$分局 , start = 1 , stop = 2)
detection_rate_need <- group_by(detection_rate,分區) %>% summarise(區域 = n() , 發生數 = sum(as.numeric(`發生數(件)`)) , 破獲數 = sum(as.numeric(`破獲數(件)`)))
detection_rate_need$破案率 <- round(detection_rate_need$破獲數/detection_rate_need$發生數,digits = 2)
detection_rate_need <- detection_rate_need[c(1:12),]
detection_rate_need$地區 <- paste0(detection_rate_need$分區,"區")
detection_rate_need <- detection_rate_need[,c(3:6)]
##平均所得
average_income$所得 <- as.numeric(average_income$所得)*1000
##完整camera資料
camera_new$地區 <- paste0(substr(camera_new$所屬單位 , start = 1 , stop = 2),"區")
camera_new_need <- camera_new[,c(1,3,5)]
camera_new_need_statistics <- group_by(camera_new_need,地區) %>% summarise(camera_new_number = n())
##資料結合
##merge3 有台北市各區域總人口、男生人口數、女生人口數、汽車發生偷竊次數、自行車發生偷竊次數、警察局總數
merge1 <- full_join(people_taipei_area,car_total,by="地區")
merge2 <- full_join(merge1,bike_total,by="地區")
merge3 <- full_join(merge2,police_station_total,by="地區")
merge4 <- full_join(merge3,land_taipei_need,by="地區")
merge5 <- merge(merge4,freq_location_taipei,by="地區")
merge6 <- full_join(merge5,school_total,by="地區")
merge7 <- merge(merge6,detection_rate_need,by="地區")
merge8 <- merge(merge7,average_income,by="地區")
merge9 <- merge(merge8,camera_new_need_statistics,by="地區")
View(merge9_correlation)
View(land_taipei_need)
View(merge9)
library(dplyr)
library(ggplot2)
library(corrplot)
merge9$steal_total <- merge9$carnumber+merge9$bikenumber
View(merge9)
merge9$steal_total <- merge9$carnumber+merge9$bikenumber
merge9_correlation <- merge9[,c(3:18)]
merge9_correlation$carnumber <- as.numeric(merge9_correlation$carnumber)
merge9_correlation$bikenumber <- as.numeric(merge9_correlation$bikenumber)
merge9_correlation$policenumber <- as.numeric(merge9_correlation$policenumber)
merge9_correlation$density <- as.numeric(merge9_correlation$人口密度)
merge9_correlation$camera_number <- as.numeric(merge9_correlation$camera_number)
merge9_correlation$school_number <- as.numeric(merge9_correlation$school_number)
merge9_correlation$camera_number <- as.numeric(merge9_correlation$camera_new_number)
merge9_correlation$steal_total <- as.numeric(merge9_correlation$steal_total)
merge9_correlation$number_of_occurrences <- as.numeric(merge9_correlation$發生數)
merge9_correlation$Cracked_number <- as.numeric(merge9_correlation$破獲數)
merge9_correlation$Detection_rate <- as.numeric(merge9_correlation$破案率)
merge9_correlation$land <- as.numeric(merge9_correlation$土地面積)
merge9_correlation$camera_density <- merge9_correlation$camera_number/merge9_correlation$land
merge9_correlation$income <- as.numeric(merge9_correlation$所得)
merge9_correlation_need <- merge9_correlation[c(6,9,10,17,18,20,22,23)]
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_density)),y=as.numeric(camera_density)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
ggplot()+geom_bar(data = merge9_correlation_need ,aes(x=reorder(地區,as.numeric(camera_density)),y=as.numeric(camera_density)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
View(merge9_correlation)
View(merge9)
merge9$camera_density <- merge9$camera_new_number/merge9$土地面積
merge9$camera_density <- as.numeric(merge9$camera_new_number)/as.numeric(merge9$土地面積)
##0616
library(dplyr)
library(ggplot2)
library(corrplot)
merge9$steal_total <- merge9$carnumber+merge9$bikenumber
merge9_correlation <- merge9[,c(3:19)]
merge9_correlation$carnumber <- as.numeric(merge9_correlation$carnumber)
merge9_correlation$bikenumber <- as.numeric(merge9_correlation$bikenumber)
merge9_correlation$policenumber <- as.numeric(merge9_correlation$policenumber)
merge9_correlation$density <- as.numeric(merge9_correlation$人口密度)
merge9_correlation$camera_number <- as.numeric(merge9_correlation$camera_number)
merge9_correlation$school_number <- as.numeric(merge9_correlation$school_number)
merge9_correlation$camera_number <- as.numeric(merge9_correlation$camera_new_number)
merge9_correlation$steal_total <- as.numeric(merge9_correlation$steal_total)
merge9_correlation$number_of_occurrences <- as.numeric(merge9_correlation$發生數)
merge9_correlation$Cracked_number <- as.numeric(merge9_correlation$破獲數)
merge9_correlation$Detection_rate <- as.numeric(merge9_correlation$破案率)
merge9_correlation$land <- as.numeric(merge9_correlation$土地面積)
merge9_correlation$income <- as.numeric(merge9_correlation$所得)
merge9_correlation_need <- merge9_correlation[c(6,9,10,17,18,20,22,23)]
##merge9_correlation_need <- ##merge9_correlation_need[c(1,6,8,9,10,11,12,13,14,15)]
##steak_total & 分區
ggplot()+geom_bar(data = merge9 ,aes(x=地區,y=carnumber),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "汽車竊盜次數" )
ggplot()+geom_bar(data = merge9 ,aes(x=地區,y=bikenumber),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "自行車竊盜次數" )
ggplot()+geom_bar(data = merge9 ,aes(x=地區,y=carnumber+bikenumber),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "竊盜次數" )
ggplot()+geom_bar(data = merge9 ,aes(x=地區,y=as.numeric(人口密度)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口密度" )
##correlation
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'circle',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
##CCTV數量 & 人口密度
ggplot()+geom_point(data = merge9 ,aes(x=as.numeric(camera_new_number),y=as.numeric(破案率)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "CCTV數量" , y = "人口密度" )
##CCTV數量 & 所得
ggplot()+geom_point(data = merge9 ,aes(x=as.numeric(camera_new_number),y=as.numeric(所得)),stat="identity")+geom_smooth(data = merge9 , aes(x=as.numeric(camera_new_number),y=as.numeric(所得)),method = "lm") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "CCTV數量" , y = "平均收入" )
##CCTV數量 & 所得
ggplot()+geom_point(data = merge9 ,aes(x=as.numeric(camera_new_number),y=as.numeric(people_total)),stat="identity")+geom_smooth(data = merge9 , aes(x=as.numeric(camera_new_number),y=as.numeric(people_total)),method = "lm") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "CCTV數量" , y = "學校數量" )
##bar圖
##地區與人口密度
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(人口密度)),y=as.numeric(人口密度)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口密度" )
##地區與人口數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(people_total)),y=as.numeric(people_total)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口數" )
##地區與平均收入
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(所得)),y=as.numeric(所得)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "平均收入" )
##地區與破案率
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(破案率)),y=as.numeric(破案率)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "破案率" )
##地區與CCTV數量
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_new_number)),y=as.numeric(camera_new_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
##地區與學校數目
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(school_number)),y=as.numeric(school_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "學校數目" )
##地區與警察局
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(policenumber)),y=as.numeric(policenumber)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "警察局" )
##地區與犯罪次數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(發生數)),y=as.numeric(發生數)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "犯罪次數" )
## TreeMap
library(treemap)
library(reshape2)
abc1 <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/ss10101ya201761650129.txt")
abc1 <- abc1[c(1),]
abc12<-melt(abc1,id.vars = c())
abc12 <- abc12[c(-2,-3,-4,-5,-14,-15,-30,-31,-32,-33,-34,-42,-43),]
treemap(abc12,
index=c("variable"), #分組依據
vSize="value", #區塊大小
vColor="value", #顏色深淺
type="value",fontfamily.title = "HanziPen TC Regular" , fontfamily.labels = "HanziPen TC Regular" , title = "大安區刑事案件分類")
##TT
##bar圖
##地區與人口密度
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(人口密度)),y=as.numeric(人口密度)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口密度" )
##地區與人口數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(people_total)),y=as.numeric(people_total)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "人口數" )
##地區與平均收入
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(所得)),y=as.numeric(所得)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "平均收入" )
##地區與破案率
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(破案率)),y=as.numeric(破案率)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "破案率" )
##地區與CCTV數量
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_new_number)),y=as.numeric(camera_new_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
##地區與學校數目
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(school_number)),y=as.numeric(school_number)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "學校數目" )
##地區與警察局
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(policenumber)),y=as.numeric(policenumber)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "警察局" )
##地區與犯罪次數
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(發生數)),y=as.numeric(發生數)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "犯罪次數" )
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_density)),y=as.numeric(camera_density)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_density)),y=as.numeric(camera_density)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
merge9_correlation_need <- merge9_correlation[c(6,9,10,17,18,20,22,23)]
View(merge9_correlation_need)
View(merge9_correlation_need)
merge9_correlation_need <- merge9_correlation_need[,c(-2)]
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_density)),y=as.numeric(camera_density)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV數量" )
ggplot()+geom_bar(data = merge9 ,aes(x=reorder(地區,as.numeric(camera_density)),y=as.numeric(camera_density)),stat="identity") +theme(text=element_text(family="HanziPen TC Regular"))+labs(x = "地區" , y = "CCTV平均密度" )
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'circle',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
View(merge9_correlation)
merge9_correlation_need <- merge9_correlation[c(6,9,10,17,18,19,21,23)]
merge9_correlation_need <- merge9_correlation_need[,c(-2)]
M <- cor(merge9_correlation_need,method="kendall")
cor_properties <- corrplot(M, method = 'circle',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
