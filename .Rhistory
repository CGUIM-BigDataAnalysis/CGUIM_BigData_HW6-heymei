
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
addr <- c("台北市松江路124巷29號3樓", "台北市仁愛路二段88號13樓", "台北市德行東路358巷24弄10號")
res <- list()
for(i in 1:length(addr)){
point <- geoPoint(addr[i])
res[[i]] <- data.frame(point)
cat(i, as.matrix(point)[1,], "\n")
Sys.sleep(0.1)
}
tmp <- do.call(rbind, res) # 如果沒有查詢失敗可以無痛合併
distinct(tmp, address) # 移除相同地址多筆經緯度 (直接取第一筆)
library(httr)
library(RCurl)
library(XML)
library(bitops)
library(dplyr)
# Google map 地址轉經緯度
geoPoint = function(address, verbose=FALSE) {
#若未輸入地址, return錯誤
if(verbose) cat(address,"\n")
root = "http://maps.google.com/maps/api/geocode/"
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")

#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
# Demo example
addr <- c("台北市松江路124巷29號3樓", "台北市仁愛路二段88號13樓", "台北市德行東路358巷24弄10號")
res <- list()
for(i in 1:length(addr)){
point <- geoPoint(addr[i])
res[[i]] <- data.frame(point)
cat(i, as.matrix(point)[1,], "\n")
Sys.sleep(0.1)
}
tmp <- do.call(rbind, res) # 如果沒有查詢失敗可以無痛合併
distinct(tmp, address) # 移除相同地址多筆經緯度 (直接取第一筆)
View(tmp)
View(camera)
<<<<<<< Updated upstream
>>>>>>> e9ad2d790e7f44e9588f48ed99e68a1802535ee1
library(dplyr)
##人口表
##people_taipei 只有台北市的人口資料
##people_taipei_area 台北市各區域的總人口，男生人口，女生人口
people_taipei <- people[grepl("臺北市",people$區域別),]
people_taipei_area <- group_by(people_taipei,區域別) %>% summarise(people_total = sum(as.numeric(人口數)) , people_man = sum(as.numeric(`人口數-男`)) , people_woman = sum(as.numeric(`人口數-女`)))
people_taipei_area$地區 <- substr(people_taipei_area$區域別 , start = 4 , stop = 6)
##汽車偷竊
##cartotal 台北市各區域汽車偷竊次數
car$地區 <- substr(car$`發生(現)地點`,start = 4,stop = 6)
car_total <- group_by(car,地區) %>% summarise(carnumber = n()) #地區&時段
##自行車偷竊
##biketotal 台北市各區域自行車偷竊次數
bike$地區 <- substr(bike$`發生(現)地點` , start = 4 , stop = 6)
bike_total <- group_by(bike,地區) %>% summarise(bikenumber = n())
##警察局
##台北市各區域警察局總數
police$地區 <- substr(police$poi_addr , start = 4 , stop = 6)
police_station_total <-  group_by(police,地區) %>% summarise(policenumber = n())
##人口密度
##land_taipei 臺北市資料
land_taipei <- land[grepl("臺北市",land$區域別),]
land_taipei$地區 <- substr(land_taipei$區域別 , start = 4 , stop = 6)
land_taipei_need <-land_taipei[,c(5,6)]
##監視器
##
camera_need <- camera[,c(3,5)]
camera_need$precinct <- substr(camera_need$precinct , start = 1 , stop = 2)
camera_need$地區 <- ifelse(camera_need$precinct=="",yes="",no = paste0(camera_need$precinct,"區"))
camera_need <- camera_need[!precinct==""]
<<<<<<< HEAD
freq_location_taipei<-camera_need[,.N,by = 地區]
colnames(freq_location_taipei) <- c("地區","camera_number")
##學校
school[grepl('中崙高中',school_name)]$address <- "臺北市松山區八德路四段101號"
school[grepl('中崙高中',school_name)]$address <- iconv(school[grepl('中崙高中',school_name)]$address,"utf-8","utf-8")
school$地區 <- substr(school$address , start = 4 , stop = 6)
school_total <- school[,.N,by = "地區"]
colnames(school_total) <- c("地區","school_number")
#以學校層級分
school_byschool <- school[,.N,by = school]
colnames(school_byschool) <- c("school","school_number")
##破案率
detection_rate <- detection_rate[c(1:180),]
detection_rate$分區 <- substr(detection_rate$分局 , start = 1 , stop = 2)
detection_rate_need <- group_by(detection_rate,分區) %>% summarise(區域 = n() , 發生數 = sum(as.numeric(`發生數(件)`)) , 破獲數 = sum(as.numeric(`破獲數(件)`)))
detection_rate_need$破案率 <- round(detection_rate_need$破獲數/detection_rate_need$發生數,digits = 2)
detection_rate_need <- detection_rate_need[c(1:12),]
detection_rate_need$地區 <- paste0(detection_rate_need$分區,"區")
detection_rate_need <- detection_rate_need[,c(2:5)]
##平均所得
average_income$所得 <- as.numeric(average_income$所得)*1000
##資料結合
##merge3 有台北市各區域總人口、男生人口數、女生人口數、汽車發生偷竊次數、自行車發生偷竊次數、警察局總數
merge1 <- full_join(people_taipei_area,car_total,by="地區")
merge2 <- full_join(merge1,bike_total,by="地區")
merge3 <- full_join(merge2,police_station_total,by="地區")
merge4 <- full_join(merge3,land_taipei_need,by="地區")
merge5 <- merge(merge4,freq_location_taipei,by="地區")
merge6 <- full_join(merge5,school_total,by="地區")
merge7 <- merge(merge6,detection_rate_need,by="地區")
detection_rate_need$破案率 <- round(detection_rate_need$破獲數/detection_rate_need$發生數,digits = 2)
detection_rate_need <- detection_rate_need[c(1:12),]
detection_rate_need$地區 <- paste0(detection_rate_need$分區,"區")
#install.packages("data.table")
library(data.table)
car <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
bike <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/bike.txt" ,colClasses = "character")
police <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/police.txt" ,colClasses = "character")
people <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/opendata10512M030.csv",colClasses = "character" , skip = 1)
land <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/opendata105N010.csv",colClasses = "character" , skip = 1)
camera <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/1041008.csv",colClasses = "character")
school <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/1050113臺北市各級學校分布圖%2528含國小_國中_高中職_特教學校_市立大學%25291030730+%281%29.txt",colClasses = "character")
detection_rate <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/ss10101cm2017614235576.txt",colClasses = "character")
average_income <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R FInal/txt/台北各區家戶平均所得.txt",colClasses = "character")
=======
>>>>>>> e9ad2d790e7f44e9588f48ed99e68a1802535ee1
library(dplyr)
people_taipei <- people[grepl("臺北市",people$區域別),]
people_taipei_area <- group_by(people_taipei,區域別) %>% summarise(people_total = sum(as.numeric(人口數)) , people_man = sum(as.numeric(`人口數-男`)) , people_woman = sum(as.numeric(`人口數-女`)))
people_taipei_area$地區 <- substr(people_taipei_area$區域別 , start = 4 , stop = 6)
car$地區 <- substr(car$`發生(現)地點`,start = 4,stop = 6)
car_total <- group_by(car,地區) %>% summarise(carnumber = n()) #地區&時段
bike$地區 <- substr(bike$`發生(現)地點` , start = 4 , stop = 6)
bike_total <- group_by(bike,地區) %>% summarise(bikenumber = n())
police$地區 <- substr(police$poi_addr , start = 4 , stop = 6)
police_station_total <-  group_by(police,地區) %>% summarise(policenumber = n())
land_taipei <- land[grepl("臺北市",land$區域別),]
land_taipei$地區 <- substr(land_taipei$區域別 , start = 4 , stop = 6)
land_taipei_need <-land_taipei[,c(5,6)]
camera_need <- camera[,c(3,5)]
camera_need$precinct <- substr(camera_need$precinct , start = 1 , stop = 2)
camera_need$地區 <- ifelse(camera_need$precinct=="",yes="",no = paste0(camera_need$precinct,"區"))
camera_need <- camera_need[!precinct==""]
<<<<<<< HEAD
freq_location_taipei<-camera_need[,.N,by = 地區]
colnames(freq_location_taipei) <- c("地區","camera_number")
school[grepl('中崙高中',school_name)]$address <- "臺北市松山區八德路四段101號"
school[grepl('中崙高中',school_name)]$address <- iconv(school[grepl('中崙高中',school_name)]$address,"utf-8","utf-8")
school$地區 <- substr(school$address , start = 4 , stop = 6)
school_total <- school[,.N,by = "地區"]
colnames(school_total) <- c("地區","school_number")
school_byschool <- school[,.N,by = school]
colnames(school_byschool) <- c("school","school_number")
detection_rate <- detection_rate[c(1:180),]
detection_rate$分區 <- substr(detection_rate$分局 , start = 1 , stop = 2)
detection_rate_need <- group_by(detection_rate,分區) %>% summarise(區域 = n() , 發生數 = sum(as.numeric(`發生數(件)`)) , 破獲數 = sum(as.numeric(`破獲數(件)`)))
detection_rate_need$破案率 <- round(detection_rate_need$破獲數/detection_rate_need$發生數,digits = 2)
detection_rate_need <- detection_rate_need[c(1:12),]
detection_rate_need$地區 <- paste0(detection_rate_need$分區,"區")
detection_rate_need <- detection_rate_need[,c(3:6)]
average_income$所得 <- as.numeric(average_income$所得)*1000
merge1 <- full_join(people_taipei_area,car_total,by="地區")
merge2 <- full_join(merge1,bike_total,by="地區")
merge3 <- full_join(merge2,police_station_total,by="地區")
merge4 <- full_join(merge3,land_taipei_need,by="地區")
merge5 <- merge(merge4,freq_location_taipei,by="地區")
merge6 <- full_join(merge5,school_total,by="地區")
merge7 <- merge(merge6,detection_rate_need,by="地區")
View(merge7)
View(average_income)
merge8 <- merge(merge7,average_income,by="地區")
View(merge8)
=======
#這是R Code Chunk
# install.packages("showtext")
=======
library(httr)
library(RCurl)
library(XML)
library(bitops)
library(dplyr)
# Google map 地址轉經緯度
geoPoint = function(address, verbose=FALSE) {
#若未輸入地址, return錯誤
if(verbose) cat(address,"\n")
root = "http://maps.google.com/maps/api/geocode/"
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
# Demo example
addr <- c(camera$location)
res <- list()
for(i in 1:length(addr)){
point <- geoPoint(addr[i])
res[[i]] <- data.frame(point)
cat(i, as.matrix(point)[1,], "\n")
Sys.sleep(0.1)
}
library(httr)
library(RCurl)
library(XML)
library(bitops)
library(dplyr)
# Google map 地址轉經緯度
geoPoint = function(address, verbose=FALSE) {
#若未輸入地址, return錯誤
if(verbose) cat(address,"\n")
root = "http://maps.google.com/maps/api/geocode/"
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
# Demo example
addr <- c(camera$location)
res <- list()
for(i in 1:length(addr)){
point <- geoPoint(addr[i])
res[[i]] <- data.frame(point)
cat(i, as.matrix(point)[1,], "\n")
Sys.sleep(0.1)
}
library(httr)
library(RCurl)
library(XML)
library(bitops)
library(dplyr)
# Google map 地址轉經緯度
geoPoint = function(address, verbose=FALSE) {
#若未輸入地址, return錯誤
if(verbose) cat(address,"\n")
root = "http://maps.google.com/maps/api/geocode/"
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
# Demo example
addr <- c(camera$location)
res <- list()
for(i in 1:length(addr)){
point <- geoPoint(addr[i])
res[[i]] <- data.frame(point)
cat(i, as.matrix(point)[1,], "\n")
Sys.sleep(0.1)
}
View(camera)
library(httr)
library(RCurl)
library(XML)
library(bitops)
>>>>>>> Stashed changes
library(dplyr)
# Google map 地址轉經緯度
geoPoint = function(address, verbose=FALSE) {
#若未輸入地址, return錯誤
if(verbose) cat(address,"\n")
root = "http://maps.google.com/maps/api/geocode/"
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
# Demo example
addr <- c(camera$location)
res <- list()
for(i in 1:length(addr)){
point <- geoPoint(addr[i])
res[[i]] <- data.frame(point)
cat(i, as.matrix(point)[1,], "\n")
Sys.sleep(0.1)
}
library(httr)
library(RCurl)
library(XML)
library(bitops)
library(dplyr)
# Google map 地址轉經緯度
geoPoint = function(address, verbose=FALSE) {
#若未輸入地址, return錯誤
if(verbose) cat(address,"\n")
root = "http://maps.google.com/maps/api/geocode/"
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
# Demo example
addr <- c(camera$location[1:100,])
library(httr)
library(RCurl)
library(XML)
library(bitops)
library(dplyr)
<<<<<<< Updated upstream
##library(showtext)
##showtext.auto(enable = TRUE)
library(ggplot2)
merge3<-mutate(merge3, "竊盗總數"=carnumber+bikenumber)
summary(merge3$bikenumber)
hist.bike<-merge3$bikenumber
names(hist.bike)<-merge3$地區
summary(merge3$carnumber)
hist.car<-merge3$carnumber
names(hist.car)<-merge3$地區
x.par <- par(mfrow = c(1,2))
barplot(hist.car, xlab = "區域別", ylab = "次數", main ="車在各區被竊盗的次數",density=5 , family = "HanziPen TC Regular")
barplot(hist.bike, xlab = "區域別", ylab = "次數", main ="自行車在各區被竊盗的次數",density=5, ylim=c(0, 140) , family = "HanziPen TC Regular")
par(x.par)
#車被竊盗的量比自行車的量高出很多
shapiro.test(merge3$竊盗總數)
#不服從常態分配
cor(merge3$竊盗總數, merge3$policenumber)
#各區警察局的數量與竊盗總數的相關係數皆趨近於零，線性關係很底。
cov(merge3$竊盗總數, merge3$policenumber)
#各區警察局的數量與竊盗總數的共變異數的絕對值皆<2,線性關係很弱。
steal.car<- rbind(car,bike)
steal.car1<-steal.car[,c(2,4,6)]
steal.car1<- group_by(steal.car1, 地區)%>%
mutate("竊盗總數"= n())
steal.car2<- steal.car1[!duplicated(steal.car1[, c("發生時段", "地區", "案類")]),]
steal.car2 <- full_join(steal.car2,policetotal,by="地區") %>%
full_join(people_taipei_area[, c(2,5)],by="地區")
#取得各區在某時段的竊盗總數、總人口數、警察局數
#-------------------------------
steal.car3 <- full_join(steal.car2, merge6[,c('地區','人口密度')], by="地區") %>%
full_join(merge6[,c('地區','camera_number')], by="地區") %>%
full_join(merge6[,c('地區','school_number')], by="地區")
qplot(竊盗總數, camera_number, data = steal.car3, main="各區域竊盜事件數與監視器相關性",xlab = "竊盜事件數", ylab = "監視器數量")
qplot(竊盗總數, school_number, data = steal.car3, main="各區域竊盜事件數與學校數相關性",xlab = "竊盜事件數", ylab = "學校數量")
qplot(竊盗總數, 人口密度, data = steal.car3, main="各區域竊盜事件數與人口密度相關性",xlab = "竊盜事件數", ylab = "人口密度")
cor(steal.car3$竊盗總數, as.numeric(steal.car3$人口密度)) #獨立
cov(steal.car3$竊盗總數, as.numeric(steal.car3$人口密度)) #正相關
cor(steal.car3$竊盗總數, steal.car3$camera_number) #　0.39
cov(steal.car3$竊盗總數, steal.car3$camera_number) #正相關
cor(steal.car3$竊盗總數, steal.car3$school_number) #  0.41
cov(steal.car3$竊盗總數, steal.car3$school_number) #正相關
#-------------------------------
qplot(竊盗總數, policenumber, data = steal.car2, main="各區域竊盜事件數與警察局的分佈相關性",xlab = "竊盜事件數", ylab = "警察局數量", color = 發生時段) +theme(text=element_text(family = "HanziPen TC Regular", size=12))
qplot(竊盗總數, people_total, data = steal.car2, main="各區域竊盜事件數與總人口數相關性",xlab = "竊盜事件數", ylab = "總人口數", color = 發生時段) +theme(text=element_text(family = "HanziPen TC Regular", size=12))
#可見人口與警察局的多寡不防礙竊盜的發生，竊盗發生的時間沒有集中的趨勢
qplot(地區, data = steal.car, main="各區域竊盜事件數")+theme(text=element_text(family = "HanziPen TC Regular", size=12))
# 大安區與北投區發生竊盗事件最高。
merge6_1 <- merge6[,(3:11)]
merge6_1$carnumber <- as.numeric(merge6_1$carnumber)
merge6_1$bikenumber <- as.numeric(merge6_1$bikenumber)
merge6_1$policenumber <- as.numeric(merge6_1$policenumber)
merge6_1$人口密度 <- as.numeric(merge6_1$人口密度)
merge6_1$camera_number <- as.numeric(merge6_1$camera_number)
merge6_1$school_number <- as.numeric(merge6_1$school_number)
library(corrplot)
M <- cor(merge6_1,method="kendall")
cor_properties <- corrplot(M, method = 'number',order ="hclust", tl.col="black", tl.cex = 1, tl.offset = 1, tl.srt = 40)
>>>>>>> e9ad2d790e7f44e9588f48ed99e68a1802535ee1
=======
# Google map 地址轉經緯度
geoPoint = function(address, verbose=FALSE) {
#若未輸入地址, return錯誤
if(verbose) cat(address,"\n")
root = "http://maps.google.com/maps/api/geocode/"
#Google編碼為UTF8, 中文要轉碼後帶入URL才會正確
# address = iconv(address,"big5","utf8")
#POI API型態(XML or JSON)
return.call = "xml"
sensor = "false"
#產生URL
url_gen = paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
#擷取網頁原始碼
html_code = xmlParse(url_gen)
#若status為OK抓取資料, 若不為OK return status
if(xpathSApply(html_code,"//GeocodeResponse//status",xmlValue)=="OK") {
lat = xpathSApply(html_code,"//result//geometry//location//lat",xmlValue)
lng = xpathSApply(html_code,"//result//geometry//location//lng",xmlValue)
loc_type = xpathSApply(html_code,"//result//geometry//location_type",xmlValue)
return(cbind(lat, lng, loc_type, address))
} else {
return(paste("Status:", xpathSApply(html_code,"//GeocodeResponse//status",xmlValue), sep = " "))
}
}
# Demo example
addr <- c(camera$location[1:100])
res <- list()
for(i in 1:length(addr)){
point <- geoPoint(addr[i])
res[[i]] <- data.frame(point)
cat(i, as.matrix(point)[1,], "\n")
Sys.sleep(0.1)
}
>>>>>>> Stashed changes
<<<<<<< Updated upstream
#install.packages("data.table")
library(data.table)
car <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
bike <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/bike.txt" ,colClasses = "character")
police <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/police.txt" ,colClasses = "character")
people <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/opendata10512M030.csv",colClasses = "character" , skip = 1)
land <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/opendata105N010.csv",colClasses = "character" , skip = 1)
camera <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/1041008.csv",colClasses = "character")
school <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/1050113臺北市各級學校分布圖%2528含國小_國中_高中職_特教學校_市立大學%25291030730+%281%29.txt",colClasses = "character")
detection_rate <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/ss10101cm2017614235576.txt",colClasses = "character")
average_income <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R FInal/txt/台北各區家戶平均所得.txt",colClasses = "character")
library(dplyr)
##人口表
##people_taipei 只有台北市的人口資料
##people_taipei_area 台北市各區域的總人口，男生人口，女生人口
people_taipei <- people[grepl("臺北市",people$區域別),]
people_taipei_area <- group_by(people_taipei,區域別) %>% summarise(people_total = sum(as.numeric(人口數)) , people_man = sum(as.numeric(`人口數-男`)) , people_woman = sum(as.numeric(`人口數-女`)))
people_taipei_area$地區 <- substr(people_taipei_area$區域別 , start = 4 , stop = 6)
##汽車偷竊
##cartotal 台北市各區域汽車偷竊次數
car$地區 <- substr(car$`發生(現)地點`,start = 4,stop = 6)
car_total <- group_by(car,地區) %>% summarise(carnumber = n()) #地區&時段
##自行車偷竊
##biketotal 台北市各區域自行車偷竊次數
bike$地區 <- substr(bike$`發生(現)地點` , start = 4 , stop = 6)
bike_total <- group_by(bike,地區) %>% summarise(bikenumber = n())
##警察局
##台北市各區域警察局總數
police$地區 <- substr(police$poi_addr , start = 4 , stop = 6)
police_station_total <-  group_by(police,地區) %>% summarise(policenumber = n())
##人口密度
##land_taipei 臺北市資料
land_taipei <- land[grepl("臺北市",land$區域別),]
land_taipei$地區 <- substr(land_taipei$區域別 , start = 4 , stop = 6)
land_taipei_need <-land_taipei[,c(5,6)]
##監視器
##
camera_need <- camera[,c(3,5)]
camera_need$precinct <- substr(camera_need$precinct , start = 1 , stop = 2)
camera_need$地區 <- ifelse(camera_need$precinct=="",yes="",no = paste0(camera_need$precinct,"區"))
camera_need <- camera_need[!precinct==""]
freq_location_taipei<-camera_need[,.N,by = 地區]
colnames(freq_location_taipei) <- c("地區","camera_number")
##學校
school[grepl('中崙高中',school_name)]$address <- "臺北市松山區八德路四段101號"
school[grepl('中崙高中',school_name)]$address <- iconv(school[grepl('中崙高中',school_name)]$address,"utf-8","utf-8")
school$地區 <- substr(school$address , start = 4 , stop = 6)
school_total <- school[,.N,by = "地區"]
colnames(school_total) <- c("地區","school_number")
#以學校層級分
school_byschool <- school[,.N,by = school]
colnames(school_byschool) <- c("school","school_number")
##破案率
detection_rate <- detection_rate[c(1:180),]
detection_rate$分區 <- substr(detection_rate$分局 , start = 1 , stop = 2)
detection_rate_need <- group_by(detection_rate,分區) %>% summarise(區域 = n() , 發生數 = sum(as.numeric(`發生數(件)`)) , 破獲數 = sum(as.numeric(`破獲數(件)`)))
detection_rate_need$破案率 <- round(detection_rate_need$破獲數/detection_rate_need$發生數,digits = 2)
detection_rate_need <- detection_rate_need[c(1:12),]
detection_rate_need$地區 <- paste0(detection_rate_need$分區,"區")
detection_rate_need <- detection_rate_need[,c(3:6)]
##平均所得
average_income$所得 <- as.numeric(average_income$所得)*1000
##資料結合
##merge3 有台北市各區域總人口、男生人口數、女生人口數、汽車發生偷竊次數、自行車發生偷竊次數、警察局總數
merge1 <- full_join(people_taipei_area,car_total,by="地區")
merge2 <- full_join(merge1,bike_total,by="地區")
merge3 <- full_join(merge2,police_station_total,by="地區")
merge4 <- full_join(merge3,land_taipei_need,by="地區")
merge5 <- merge(merge4,freq_location_taipei,by="地區")
merge6 <- full_join(merge5,school_total,by="地區")
merge7 <- merge(merge6,detection_rate_need,by="地區")
merge8 <- merge(merge7,average_income,by="地區")
View(merge8)
=======
camera_new <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/台北各分局的管核的監視器" colClasses = "character")
camera_new <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/台北各分局的管核的監視器", colClasses = "character")
#install.packages("data.table")
library(data.table)
car <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
library(data.table)
car <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/car.txt" ,colClasses = "character")
bike <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/txt/bike.txt" ,colClasses = "character")
camera_new <- fread("~/Documents/GitHub/CGUIM_BigData_HW6-heymei/R Final/台北各分局的管核的監視器", colClasses = "character")
camera_new <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/台北各分局的管核的監視器", colClasses = "character")
camera_new <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/台北各分局的管核的監視器.csv", colClasses = "character")
library(dplyr)
View(camera_new)
View(camera_new)
camera_new <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/台北各分局的管核的監視器.txt", colClasses = "character")
View(camera_new)
camera_new <- fread("~/R/CGUIM_BigData_HW6-heymei/R Final/txt/台北各分局的管核的監視器.txt", colClasses = "character" ,skip = 1)
camera_new$地區 <- paste0(substr(camera_new$所屬單位 , start = 1 , stop = 2),"區")
camera_new_need <- camera_new[,c(1,3,5)]
View(merge8)
merge9 <- merge(merge8,camera_new_need,by="地區")
View(merge9)
View(camera_new_need)
camera_new_need_statistics <- group_by(camera_new_need,地區) %>% summarise(camera_new_number = n())
View(camera_new_need_statistics)
merge9 <- merge(merge8,camera_new_need_statistics,by="地區")
View(merge9)
>>>>>>> Stashed changes
